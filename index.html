<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐰 Bunny CC Archive v8.0.1 - 🐛 Bug Fix Rabbit</title>
    <!-- Tailwind CSS CDN - 注意：用於生產環境時，請作為 PostCSS 插件安裝或使用 Tailwind CLI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Press Start 2P 用於像素化標題, Noto Sans SC 用於主要內容 -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS 變數用於 TRON 主題 (顏色透過 JS 動態設置) */
        :root {
            --glow-rgb: 34, 211, 238; /* 青色 - 預設 */
            --glow-light-rgb: 103, 232, 249; /* 淺青色 - 預設 */
            --bg-color: #010409; /* 深藍色 - 預設基礎背景 */
            /* 面板表面顏色現在動態使用 glow-rgb 並帶有透明度 */
            --surface-color: rgba(var(--glow-rgb), 0.08); /* 面板的微妙發光色調 */
            --grid-color: rgba(var(--glow-rgb), 0.15); /* 網格線顏色基於發光色 */
            --text-color: #e6edf3; /* 淺灰白色文字 */
            --text-muted-color: #8b949e; /* 柔和灰色文字 */

            /* 新增: 背景徑向漸變顏色 (透過 JS 動態設置) */
            --bg-radial-start: rgba(var(--glow-rgb), 0.08); /* 中心微弱發光 */
            --bg-radial-end: rgba(1, 4, 9, 0.9); /* 融入深色背景 */
            --grad-pos-x: 20%; /* 透過 CSS 關鍵幀動畫 */
            --grad-pos-y: 20%; /* 透過 CSS 關鍵幀動畫 */
        }

        /* 日間模式特定覆蓋 (透過 JS 激活) */
        body.day-mode {
            --bg-color: #f0f8ff; /* 淺藍色作為較淺的基礎色 */
            --text-color: #333333; /* 較深的文字用於對比 */
            --text-muted-color: #666666; /* 日間模式的柔和灰色 */
            --surface-color: rgba(var(--glow-rgb), 0.15); /* 面板的較淺發光色調 */

            /* 日間模式徑向漸變調整 */
            --bg-radial-start: rgba(var(--glow-rgb), 0.15); /* 較強的發光起始 */
            --bg-radial-end: rgba(240, 248, 255, 0.9); /* 融入淺色背景 */
        }

        /* 基本樣式 */
        body {
            font-family: 'Noto Sans SC', sans-serif; /* 主要內容使用 Noto Sans SC 字體 */
            background-color: var(--bg-color); /* 基礎背景色 */
            color: var(--text-color);
            transition: background-color 0.5s ease, color 0.5s ease; /* 主題切換平滑過渡 */
            overflow-x: hidden; /* 防止水平滾動條 */
            overflow-y: auto; /* 允許內容垂直滾動 */
            opacity: 0;
            animation: fadeIn 1s ease 0.5s forwards;
            position: relative; /* 用於疊加層的 z-index 上下文 */
        }
        
        .font-pixel { font-family: 'Press Start 2P', cursive; } /* 僅對特定元素應用像素字體 */
        .glow-text { color: rgb(var(--glow-light-rgb)); text-shadow: 0 0 8px rgba(var(--glow-rgb), 0.8); }
        .glow-border { 
            border: 1px solid rgba(var(--glow-rgb), 0.4); 
            box-shadow: 0 0 12px rgba(var(--glow-rgb), 0.2), inset 0 0 8px rgba(var(--glow-rgb), 0.15); 
            transition: border-color 0.5s ease, box-shadow 0.5s ease; /* 平滑過渡 */
        }
        
        /* 動畫網格和徑向漸變背景 */
        #grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; /* 位於所有內容之下 */
            background-image:
                /* 徑向漸變用於光影效果 - 第一層 */
                radial-gradient(circle at var(--grad-pos-x) var(--grad-pos-y), 
                                var(--bg-radial-start) 0%, 
                                var(--bg-radial-end) 60%),
                /* 現有網格線 - 第二層 */
                linear-gradient(rgba(var(--glow-rgb), 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(var(--glow-rgb), 0.15) 1px, transparent 1px);
            background-size: cover, 50px 50px, 50px 50px; /* 徑向覆蓋，網格 50px */
            background-repeat: no-repeat, repeat, repeat; /* 徑向不重複，網格重複 */
            /* 徑向漸變移動路徑更新為更隨機和流暢 */
            animation: pan-grid 20s linear infinite, radial-move 60s cubic-bezier(0.4, 0, 0.2, 1) infinite alternate;
            transition: background-image 0.5s ease; /* 主題顏色切換的平滑過渡 */
        }

        /* 掃描線疊加 */
        #scanline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100; /* 位於大多數內容之上，模態框之下 */
            pointer-events: none; /* 允許點擊穿透 */
            background: linear-gradient(to bottom, rgba(18, 18, 18, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(to bottom, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.08));
            background-size: 100% 4px, 100% 1px;
            animation: scanline-move 10s linear infinite;
        }

        /* 派克曼頭像容器 - 增強動態效果 */
        .pacman-container {
            position: relative;
            width: 160px; height: 160px;
            border-radius: 50%; 
            overflow: hidden; 
            transition: box-shadow 0.3s ease; /* 平滑發光過渡 */
        }
        .pacman-container .profile-image-wrapper {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden; 
            position: relative; 
            transition: clip-path 0.4s ease-in-out; /* 平滑嘴巴動畫 */
            /* 初始狀態: 完整圓形 */
            clip-path: circle(50% at 50% 50%);
        }

        .pacman-container:hover .profile-image-wrapper {
            /* 懸停時，創建派克曼嘴巴效果 */
            clip-path: polygon(0% 0%, 100% 0%, 100% 40%, 50% 50%, 100% 60%, 100% 100%, 0% 100%);
        }
        
        /* 懸停時添加動態發光效果 */
        .pacman-container:hover {
            box-shadow: 0 0 30px rgba(var(--glow-rgb), 0.9), inset 0 0 20px rgba(var(--glow-rgb), 0.6); /* 懸停時強烈發光 */
        }


        /* 主容器和 UI 元素 */
        .main-container {
            background-color: var(--surface-color); /* 現在使用動態表面色 */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            min-height: 80vh; 
            min-width: 320px; /* 確保小螢幕的最小寬度 */
            position: relative; /* 用於模塊的 z-index 上下文 */
            transition: background-color 0.5s ease; /* 主題切換平滑過渡 */
            border-radius: 1rem; /* 更圓潤的現代科技感 */
        }
        .ui-module { 
            transition: all 0.5s; 
            opacity: 0; 
            transform: translateY(20px); 
            animation: module-boot 0.5s ease forwards; 
            min-height: 150px; 
            background-color: rgba(var(--glow-rgb), 0.05); /* 基於主題的微妙模塊背景 */
            border-left: 3px solid rgba(var(--glow-rgb), 0.5); /* 左側邊框也基於主題 */
            transition: background-color 0.5s ease, border-left-color 0.5s ease; /* 平滑過渡 */
            border-radius: 0.75rem; /* 模塊一致的圓角 */
            box-shadow: 0 4px 15px rgba(var(--glow-rgb), 0.1); /* 更明顯的微妙陰影 */
        }
        .list-pellet li::before {
            content: '•';
            color: rgb(var(--glow-light-rgb));
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
            animation: pellet-glow 1.5s infinite alternate;
        }

        /* 模態框 */
        .modal-overlay { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 1000; } /* 確保模態框位於頂部 */
        .modal-content-base {
            background-color: var(--surface-color); /* 模態框也使用動態表面色 */
            transition: background-color 0.5s ease; /* 平滑過渡 */
            border-radius: 1rem; /* 模態框一致的圓角 */
        }


        /* 動畫 */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pan-grid { from { background-position: 0 0; } to { background-position: -50px -50px; } }
        @keyframes scanline-move { from { background-position: 0 0; } to { background-position: 0 100%; } }
        @keyframes pellet-glow { from { text-shadow: 0 0 2px; } to { text-shadow: 0 0 10px rgba(var(--glow-light-rgb), 1); } }
        @keyframes module-boot { to { opacity: 1; transform: translateY(0); } }
        /* 新增: 徑向漸變移動動畫 - 更複雜的路徑以實現隨機性 */
        @keyframes radial-move {
            0% { --grad-pos-x: 10%; --grad-pos-y: 10%; }
            16% { --grad-pos-x: 90%; --grad-pos-y: 20%; }
            32% { --grad-pos-x: 30%; --grad-pos-y: 90%; }
            48% { --grad-pos-x: 70%; --grad-pos-y: 40%; }
            64% { --grad-pos-x: 20%; --grad-pos-y: 80%; }
            80% { --grad-pos-x: 50%; --grad-pos-y: 15%; }
            100% { --grad-pos-x: 10%; --grad-pos-y: 10%; }
        }

        /* 自定義滾動條 */
        .record-scrollbar::-webkit-scrollbar { width: 8px; }
        .record-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .record-scrollbar::-webkit-scrollbar-thumb { background: rgba(var(--glow-rgb), 0.5); border-radius: 4px; }
        .record-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(var(--glow-rgb), 0.8); }

        /* 兔子樣式 */
        #wandering-rabbit {
            position: fixed;
            width: 72px; 
            height: 72px; 
            z-index: 90; 
            pointer-events: none;
            fill: rgb(var(--glow-light-rgb)); 
            filter: drop-shadow(0 0 15px rgba(var(--glow-rgb), 0.8));
        }
        .rabbit-dropping {
            position: absolute;
            width: 6px; 
            height: 6px;
            background-color: #4a2c2a; 
            border-radius: 1px; 
            transform: scale(1);
            opacity: 1;
            transition: transform 2s ease-out, opacity 2s ease-out; 
            z-index: 89; 
            pointer-events: none; 
            box-shadow: 0 0 2px rgba(0,0,0,0.5); 
        }
        .rabbit-dropping.fade-out {
            transform: scale(0.2);
            opacity: 0;
        }

        /* 確保主容器居中並佔用適當寬度 */
        .flex.items-center.justify-center.min-h-screen.p-4 {
            align-items: flex-start; /* 頂部對齊以更好地利用垂直空間 */
            padding-top: 2rem; /* 添加一些頂部內邊距 */
            padding-bottom: 2rem; /* 添加一些底部內邊距 */
        }
        /* 主內容的 flex 擴展以填充可用空間 */
        .lg\\:col-span-1.p-6.flex.flex-col.space-y-8, .lg\\:col-span-2.p-6.space-y-6 {
            flex-grow: 1;
        }

        /* 更新日誌條目樣式 */
        .changelog-entry {
            padding: 1rem; /* p-4 */
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 1rem; /* mb-4 */
            background-color: rgba(var(--glow-rgb), 0.1); /* bg-gray-800 等效，但動態 */
            border: 1px solid rgba(var(--glow-rgb), 0.4); /* border-gray-700 等效，但動態 */
            box-shadow: 0 2px 8px rgba(var(--glow-rgb), 0.1); /* 微妙陰影 */
            transition: all 0.3s ease; /* 主題切換平滑過渡 */
        }

        .changelog-entry ul {
            list-style: none; /* 移除預設項目符號 */
            padding-left: 1.5em; /* 為自定義項目符號縮進 */
        }

        .changelog-entry li::before {
            content: '★ '; /* 更新日誌的自定義星號項目符號 */
            color: rgb(var(--glow-light-rgb)); /* 使用發光色 */
            font-weight: bold;
            display: inline-block;
            width: 1.5em; /* 星號的空間 */
            margin-left: -1.5em;
        }
        /* 從全局更新日誌列表中移除彈丸樣式（如果已全局應用） */
        #changelog-list.list-pellet li::before {
            content: none; /* 覆蓋以在此處移除全局彈丸 */
        }

    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="grid-background"></div>
    <!-- 遊走兔角色 -->
    <div id="wandering-rabbit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8" fill="currentColor">
            <rect x="1" y="0" width="1" height="1"/><rect x="3" y="0" width="1" height="1"/>
            <rect x="0" y="1" width="1" height="1"/><rect x="4" y="1" width="1" height="1"/>
            <rect x="0" y="2" width="1" height="1"/><rect x="6" y="2" width="1" height="1"/>
            <rect x="0" y="3" width="1" height="1"/><rect x="6" y="3" width="1" height="1"/>
            <rect x="0" y="4" width="1" height="1"/><rect x="6" y="4" width="1" height="1"/>
            <rect x="2" y="2" width="1" height="1"/><rect x="3" y="2" width="1" height="1"/>
            <rect x="2" y="3" width="1" height="1"/><rect x="3" y="3" width="1" height="1"/>
            <rect x="1" y="5" width="1" height="1"/><rect x="2" y="5" width="1" height="1"/>
            <rect x="3" y="5" width="1" height="1"/><rect x="4" y="5" width="1" height="1"/><rect x="5" y="5" width="1" height="1"/>
        </svg>
    </div>
    <div id="scanline-overlay"></div>

    <!-- 主容器 -->
    <div class="main-container w-full max-w-7xl rounded-2xl shadow-2xl overflow-hidden transition-all duration-500 glow-border">
        <!-- 頁眉 -->
        <div class="px-4 py-2 flex items-center justify-between border-b" style="border-color: rgba(var(--glow-rgb), 0.3)">
            <!-- 更新標題文字以模仿終端提示符 -->
            <p class="font-pixel text-xs sm:text-sm tracking-widest glow-text">BCC_SYS_v8.0.1_TRON <span style="font-size: 0.75em;">CANGUROMIO_BCC@ARCHIVE:~$</span></p>
            <!-- 控制按鈕（現在使用 ID 和 programmatically 綁定事件） -->
            <div class="flex items-center space-x-3 text-gray-400">
                <button id="changelog-btn" title="更新日誌" class="transition-colors hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg></button>
                <button id="theme-btn" title="色彩循環" class="transition-colors hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg></button>
                <button id="performance-btn" title="性能監控" class="transition-colors hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg></button>
                <button id="fullscreen-btn" title="全螢幕" class="transition-colors hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5" /></svg></button>
            </div>
        </div>

        <!-- 主內容網格 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6">
            <!-- 左側面板 -->
            <div class="lg:col-span-1 p-6 flex flex-col space-y-8 ui-module" style="animation-delay: 0.2s;">
                <div class="text-center">
                    <div class="pacman-container mx-auto glow-border">
                        <div class="profile-image-wrapper">
                            <img id="profile-pic" src="./dist/Bunny CC_Profile.JPG" 
                                 onerror="this.onerror=null; this.src='https://placehold.co/160x160/010409/22d3ee?text=Error';"
                                 class="w-full h-full object-cover">
                        </div>
                    </div>
                    <h1 class="font-pixel text-2xl font-bold mt-4 glow-text">BUNNY CC</h1>
                    <p class="text-sm font-pixel" style="color: var(--text-muted-color)">ID: B-20240312</p>
                </div>
                <div class="ui-module" style="animation-delay: 0.4s;">
                    <h2 class="font-pixel text-base pb-2 mb-4 glow-text" style="border-bottom: 1px solid rgba(var(--glow-rgb), 0.3)">里程碑</h2>
                    <div id="timing" class="space-y-2 text-sm whitespace-pre-line leading-relaxed list-pellet" style="color: var(--text-muted-color)"></div>
                </div>
            </div>

            <!-- 右側面板 -->
            <div class="lg:col-span-2 p-6 space-y-6">
                <div class="ui-module" style="animation-delay: 0.6s;">
                    <h2 class="font-pixel text-base pb-2 mb-4 glow-text" style="border-bottom: 1px solid rgba(var(--glow-rgb), 0.3)">體重軌跡</h2>
                    <div class="h-64"><canvas id="weightChart"></canvas></div>
                    <div id="weight-change-info" class="mt-4 text-center p-3 rounded-lg h-12 flex items-center justify-center text-sm" style="background-color: rgba(var(--glow-rgb), 0.05); border: 1px solid rgba(var(--glow-rgb), 0.2)"></div>
                </div>
                <div class="ui-module" style="animation-delay: 0.8s;">
                    <h2 class="font-pixel text-base pb-2 mb-4 glow-text" style="border-bottom: 1px solid rgba(var(--glow-rgb), 0.3)">數據流</h2>
                    <div id="all-records-container" class="record-scrollbar h-56 overflow-y-auto pr-2 space-y-3 text-sm"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 模態框 -->
    <div id="changelog-modal" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center">
        <div class="main-container glow-border w-11/12 max-w-2xl modal-content-base" onclick="event.stopPropagation()">
            <h2 class="font-pixel text-lg p-4 glow-text border-b" style="border-color:rgba(var(--glow-rgb), 0.3)">更新日誌</h2>
            <div class="p-6 max-h-[70vh] overflow-y-auto record-scrollbar" id="changelog-list">
                <!-- 更新日誌內容將由 JavaScript 填充 -->
            </div>
            <!-- 模態框關閉按鈕 -->
            <button id="changelog-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>
    <div id="theme-modal" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center">
        <div class="main-container glow-border w-11/12 max-w-md modal-content-base" onclick="event.stopPropagation()">
            <h2 class="font-pixel text-lg p-4 glow-text border-b" style="border-color:rgba(var(--glow-rgb), 0.3)">色彩循環</h2>
            <div id="theme-grid" class="p-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4"></div>
            <!-- 模態框關閉按鈕 -->
            <button id="theme-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>
    <div id="performance-modal" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center">
        <div class="main-container glow-border w-11/12 max-w-lg modal-content-base" onclick="event.stopPropagation()">
            <h2 class="font-pixel text-lg p-4 glow-text border-b" style="border-color:rgba(var(--glow-rgb), 0.3)">性能監控</h2>
            <div class="p-6 max-h-[70vh] overflow-y-auto record-scrollbar" id="performance-metrics">
                <p class="text-sm" style="color: var(--text-muted-color);">激活感應器陣列以獲取實時指標。</p>
                <!-- 按鈕現在使用 ID 並 programmatically 綁定事件 -->
                <button id="activate-sensor-btn" class="mt-4 px-4 py-2 rounded-md font-bold text-white transition-colors duration-200" style="background-color: rgb(var(--glow-rgb)); hover:background-color: rgba(var(--glow-rgb), 0.8);">激活感應器陣列</button>
                <div id="performance-data-output" class="mt-4 space-y-2 text-sm" style="color: var(--text-color);"></div>
                <p class="text-xs mt-4 text-red-400">注意: 由於安全協議，無法直接訪問 CPU/GPU 利用率和公共 IP。</p>
            </div>
            <!-- 模態框關閉按鈕 -->
            <button id="performance-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>

    <script type="module">
        // content_fetcher 是全域可用的，不需要 import
        // import { content_fetcher } from 'content_fetcher'; // 移除此行

        // --- 配置 ---
        const CONFIG = {
            PROFILE_PIC_PATH: './dist/Bunny CC_Profile.JPG', // 用於 GitHub Pages 部署的相對路徑
            PET_RECORDS_FETCH_ID: 'uploaded:PetRecords.json', // 使用 content_fetcher 的 ID
            START_DATE: '2024/03/12 00:00:00', // 週年計時器起始日期
            // 擴展的 THEMES 陣列至 56 種獨特配色方案
            THEMES: [
                { name: '青色', rgb: '34, 211, 238', light_rgb: '103, 232, 249'},
                { name: '品紅', rgb: '244, 114, 182', light_rgb: '249, 168, 212'},
                { name: '檸檬綠', rgb: '132, 204, 22', light_rgb: '163, 230, 53'},
                { name: '橙色', rgb: '249, 115, 22', light_rgb: '251, 146, 60'},
                { name: '黃色', rgb: '251, 191, 36', light_rgb: '252, 211, 77'},
                { name: '紅色', rgb: '239, 68, 68', light_rgb: '248, 113, 113'},
                { name: '靛藍', rgb: '88, 86, 214', light_rgb: '129, 140, 248'},
                { name: '綠色', rgb: '34, 197, 94', light_rgb: '74, 222, 128'},
                { name: '白色', rgb: '229, 231, 235', light_rgb: '243, 244, 246'},
                { name: '紫色', rgb: '168, 85, 247', light_rgb: '192, 132, 252'},
                { name: '金色', rgb: '255, 215, 0', light_rgb: '255, 228, 77'},
                { name: '水鴨色', rgb: '0, 128, 128', light_rgb: '0, 168, 168'},
                { name: '珊瑚紅', rgb: '255, 127, 80', light_rgb: '255, 160, 122'},
                { name: '天藍色', rgb: '135, 206, 235', light_rgb: '173, 216, 230'},
                { name: '玫瑰色', rgb: '255, 0, 127', light_rgb: '255, 51, 153'},
                { name: '電光藍', rgb: '125, 249, 255', light_rgb: '173, 255, 255'},
                { name: '深粉紅', rgb: '255, 20, 147', light_rgb: '255, 105, 180'},
                { name: '春綠', rgb: '0, 255, 127', light_rgb: '127, 255, 212'},
                { name: '火橙色', rgb: '255, 87, 51', light_rgb: '255, 139, 90'},
                { name: '紫羅蘭', rgb: '238, 130, 238', light_rgb: '221, 160, 221'},
                { name: '森林綠', rgb: '34, 139, 34', light_rgb: '60, 179, 113'},
                { name: '寶藍色', rgb: '65, 105, 225', light_rgb: '100, 149, 237'},
                { name: '熱粉紅', rgb: '255, 105, 180', light_rgb: '255, 140, 200'},
                { name: '金黃色', rgb: '218, 165, 32', light_rgb: '255, 193, 7'},
                { name: '深蘭花紫', rgb: '153, 50, 204', light_rgb: '186, 85, 211'},
                { name: '薄荷綠', rgb: '152, 255, 152', light_rgb: '192, 255, 192'},
                { name: '石英粉', rgb: '232, 173, 192', light_rgb: '240, 200, 210'},
                { name: '午夜藍', rgb: '25, 25, 112', light_rgb: '65, 105, 225'},
                { name: '琥珀金', rgb: '255, 191, 0', light_rgb: '255, 215, 0'},
                { name: '湖藍色', rgb: '0, 139, 139', light_rgb: '0, 191, 191'},
                // 額外 26 種主題以達到 56 種
                { name: '蔚藍色', rgb: '42, 82, 190', light_rgb: '64, 130, 250'},
                { name: '深紅', rgb: '220, 20, 60', light_rgb: '255, 99, 71'},
                { name: '暗板岩灰', rgb: '47, 79, 79', light_rgb: '95, 158, 160'},
                { name: '深紫羅蘭', rgb: '148, 0, 211', light_rgb: '186, 85, 211'},
                { name: '道奇藍', rgb: '30, 144, 255', light_rgb: '65, 105, 225'},
                { name: '火磚紅', rgb: '178, 34, 34', light_rgb: '220, 20, 60'},
                { name: '紫紅色', rgb: '255, 0, 255', light_rgb: '255, 105, 180'},
                { name: '中春綠', rgb: '0, 250, 154', light_rgb: '127, 255, 212'},
                { name: '海軍藍', rgb: '0, 0, 128', light_rgb: '70, 130, 180'},
                { name: '橄欖褐', rgb: '107, 142, 35', light_rgb: '154, 205, 50'},
                { name: '橘紅色', rgb: '255, 69, 0', light_rgb: '255, 99, 71'},
                { name: '淡紫羅蘭紅', rgb: '219, 112, 147', light_rgb: '255, 182, 193'},
                { name: '秘魯色', rgb: '205, 133, 63', light_rgb: '244, 164, 96'},
                { name: '粉藍色', rgb: '176, 224, 230', light_rgb: '204, 235, 240'},
                { name: '海綠色', rgb: '46, 139, 87', light_rgb: '60, 179, 113'},
                { name: '石板藍', rgb: '106, 90, 205', light_rgb: '123, 104, 238'},
                { name: '番茄紅', rgb: '255, 99, 71', light_rgb: '255, 128, 96'},
                { name: '綠松石', rgb: '64, 224, 208', light_rgb: '128, 240, 220'},
                { name: '暗鮭魚色', rgb: '233, 150, 122', light_rgb: '255, 160, 122'},
                { name: '深天藍', rgb: '0, 191, 255', light_rgb: '135, 206, 250'},
                { name: '中海藍', rgb: '102, 205, 170', light_rgb: '127, 255, 212'},
                { name: '中海綠', rgb: '60, 179, 113', light_rgb: '84, 198, 140'},
                { name: '中石板藍', rgb: '123, 104, 238', light_rgb: '150, 135, 250'},
                { name: '鋼鐵藍', rgb: '70, 130, 180', light_rgb: '100, 149, 237'},
                { name: '暗金黃色', rgb: '184, 134, 11', light_rgb: '218, 165, 32'},
                { name: '軍藍色', rgb: '95, 158, 160', light_rgb: '120, 180, 180'}
            ]
        };

        // --- 全局狀態與 UI 元素 ---
        let weightChart = null; // Chart.js 實例
        let allRecordsData = []; // 儲存所有解析後的寵物記錄
        let weightChartData = []; // 儲存用於圖表的過濾體重記錄

        // 兔子動畫變量
        let wanderingRabbit; 
        const droppingsPool = [];
        const MAX_DROPPINGS = 70; 
        let currentDroppingIndex = 0;
        let lastDropTime = 0;
        let targetX, targetY, currentX, currentY; 
        let animationSpeedMultiplier = 1; // 動畫速度乘數，用於 Safari 優化
        let DROP_INTERVAL_MS = 150; // 掉落「巧克力豆」的時間間隔

        /**
         * 切換模態框元素的顯示狀態。
         * @param {string} modalId - 要切換的模態框元素的 ID。
         */
        function toggleModal(modalId) {
            console.log(`[DEBUG] 嘗試切換模態框: ${modalId}`);
            const modal = document.getElementById(modalId);
            if (modal) {
                const isHidden = modal.classList.contains('hidden');
                modal.classList.toggle('hidden', !isHidden);
                modal.classList.toggle('flex', isHidden); // 顯示時添加 flex

                // 只有當性能模態框顯示時才顯示指標
                if (modalId === 'performance-modal' && isHidden) { 
                    displayPerformanceMetrics(); // 調用函數
                }
            } else {
                console.error(`[ERROR] 執行 toggleModal 時未找到 ID 為 '${modalId}' 的模態框。`);
            }
        }

        /**
         * 切換文檔的全螢幕模式。
         */
        function toggleFullscreen() {
            console.log("[DEBUG] 嘗試切換全螢幕。");
            const docEl = document.documentElement;
            if (!document.fullscreenElement) {
                docEl.requestFullscreen().catch(err => console.error(`[ERROR] 進入全螢幕失敗: ${err.message}`));
            } else {
                document.exitFullscreen().catch(err => console.error(`[ERROR] 退出全螢幕失敗: ${err.message}`));
            }
        }

        /**
         * 在性能模態框中顯示瀏覽器性能指標。
         */
        function displayPerformanceMetrics() {
            console.log("[DEBUG] 顯示性能指標。");
            const performanceDataOutput = document.getElementById('performance-data-output');
            if (!performanceDataOutput) {
                console.error("[ERROR] 未找到性能數據輸出元素以進行顯示。");
                return;
            }

            let outputHtml = '<h3>當前性能數據:</h3>';

            // 記憶體使用情況 (非標準，主要用於 Chrome)
            if (window.performance && window.performance.memory) {
                const memory = window.performance.memory;
                outputHtml += `<p><strong>JS 堆使用量:</strong> ${(memory.usedJSHeapSize / (1024 * 1024)).toFixed(2)} MB</p>`;
                outputHtml += `<p><strong>總 JS 堆:</strong> ${(memory.totalJSHeapSize / (1024 * 1024)).toFixed(2)} MB</p>`;
                outputHtml += `<p><strong>JS 堆限制:</strong> ${(memory.jsHeapSizeLimit / (1024 * 1024)).toFixed(2)} MB</p>`;
            } else {
                outputHtml += `<p><em>Performance.memory API 不可用。</em></p>`;
            }

            // 導航計時 API
            if (window.performance && window.performance.getEntriesByType) {
                const navTiming = performance.getEntriesByType("navigation")[0];
                if (navTiming) {
                    outputHtml += `<h3>頁面加載時間:</h3>`;
                    outputHtml += `<p><strong>DOM 內容加載:</strong> ${(navTiming.domContentLoadedEventEnd - navTiming.domContentLoadedEventStart).toFixed(2)} ms</p>`;
                    outputHtml += `<p><strong>總加載時間:</strong> ${(navTiming.loadEventEnd - navTiming.startTime).toFixed(2)} ms</p>`;
                    outputHtml += `<p><strong>DNS 解析:</strong> ${(navTiming.domainLookupEnd - navTiming.domainLookupStart).toFixed(2)} ms</p>`;
                    outputHtml += `<p><strong>TCP 握手:</strong> ${(navTiming.connectEnd - navTiming.connectStart).toFixed(2)} ms</p>`;
                    outputHtml += `<p><strong>請求-響應延遲:</strong> ${(navTiming.responseEnd - navTiming.requestStart).toFixed(2)} ms</p>`;
                }
            } else {
                outputHtml += `<p><em>性能計時 API 不可用。</em></p>`;
            }

            // 網絡資訊 API (實驗性，並非所有瀏覽器都支持)
            if (navigator.connection) {
                const connection = navigator.connection;
                outputHtml += `<h3>網絡子系統資訊:</h3>`;
                outputHtml += `<p><strong>有效類型:</strong> ${connection.effectiveType || 'N/A'}</p>`;
                outputHtml += `<p><strong>往返時間 (RTT):</strong> ${connection.rtt || 'N/A'} ms</p>`;
                outputHtml += `<p><strong>下行帶寬:</strong> ${connection.downlink || 'N/A'} Mbps</p>`;
                outputHtml += `<p><strong>數據節省模式:</strong> ${connection.saveData ? '已啟用' : '已禁用'}</p>`;
            } else {
                outputHtml += `<p><em>網絡資訊 API 不可用。</em></p>`;
            }

            // 硬體並發 (CPU 核心數)
            if (navigator.hardwareConcurrency) {
                outputHtml += `<h3>硬體子系統資訊:</h3>`;
                outputHtml += `<p><strong>處理器核心數:</strong> ${navigator.hardwareConcurrency}</p>`;
            } else {
                outputHtml += `<p><em>處理器核心數無法檢測。</em></p>`;
            }

            // 設備記憶體 (實驗性)
            if (navigator.deviceMemory) {
                outputHtml += `<p><strong>系統記憶體 (約):</strong> ${navigator.deviceMemory} GB</p>`;
            } else {
                outputHtml += `<p><em>系統記憶體無法檢測。</em></p>`;
            }

            // 瀏覽器用戶代理和作業系統 (來自 navigator.userAgent)
            outputHtml += `<h3>瀏覽器與作業系統診斷:</h3>`;
            if (navigator && navigator.userAgent) {
                outputHtml += `<p><strong>用戶代理 (UA):</strong> ${navigator.userAgent}</p>`;
                let os = "未知";
                if (navigator.userAgent.includes("Win")) os = "Windows";
                else if (navigator.userAgent.includes("Mac")) os = "macOS";
                else if (navigator.userAgent.includes("Linux")) os = "Linux";
                else if (navigator.userAgent.includes("Android")) os = "Android";
                else if (navigator.userAgent.includes("iPad")) os = "iPadOS";
                else if (navigator.userAgent.includes("iPhone")) os = "iOS";
                outputHtml += `<p><strong>操作系統 (估計):</strong> ${os}</p>`;
            } else {
                outputHtml += `<p><em>用戶代理資訊無法訪問。</em></p>`;
            }
            
            performanceDataOutput.innerHTML = outputHtml;
        }


        /**
         * 根據 RGB 值改變應用程序的整體主題。
         * 此函數現在還會更新背景徑向漸變顏色。
         * @param {Object} theme - 包含主題 RGB 和 light_rgb 值的對象。
         */
        function changeTheme(theme) {
            console.log(`[DEBUG] 改變主題為: ${theme.name}`);
            const docEl = document.documentElement;
            docEl.style.setProperty('--glow-rgb', theme.rgb);
            docEl.style.setProperty('--glow-light-rgb', theme.light_rgb);

            // 動態設置背景徑向漸變顏色，基於主題和日間/夜間模式
            const isDayMode = document.body.classList.contains('day-mode');
            const currentBgColor = getComputedStyle(docEl).getPropertyValue('--bg-color');
            let baseBgColorRgb;
            // 嘗試解析基礎背景顏色
            const match = currentBgColor.match(/\d+/g);
            if (match && match.length >= 3) {
                baseBgColorRgb = [parseInt(match[0]), parseInt(match[1]), parseInt(match[2])];
            } else {
                // 如果解析失敗，回退到預設的深色/淺色
                baseBgColorRgb = isDayMode ? [240, 248, 255] : [1, 4, 9]; 
            }
            
            const radialStartAlpha = isDayMode ? 0.15 : 0.08;
            const radialEndAlpha = 0.9; 
            
            docEl.style.setProperty('--bg-radial-start', `rgba(${theme.rgb}, ${radialStartAlpha})`);
            docEl.style.setProperty('--bg-radial-end', `rgba(${baseBgColorRgb.join(', ')}, ${radialEndAlpha})`);

            // 也根據新主題的發光色更新面板和模態框的表面色
            const surfaceAlpha = isDayMode ? 0.15 : 0.08;
            docEl.style.setProperty('--surface-color', `rgba(${theme.rgb}, ${surfaceAlpha})`);


            // 如果圖表存在，重新渲染圖表以應用新顏色
            if (weightChart) {
                renderWeightChart(); 
            }
        }

        /**
         * 生成並將主題顏色樣本添加到主題模態框。
         */
        function generateThemeSwatches() {
            console.log("[DEBUG] 生成主題樣本。");
            const themeGrid = document.getElementById('theme-grid');
            if (!themeGrid) {
                console.error("[ERROR] 未找到主題網格元素以生成樣本。");
                return;
            }
            themeGrid.innerHTML = ''; // 清除之前的樣本
            CONFIG.THEMES.forEach(theme => {
                const swatch = document.createElement('button');
                swatch.className = "h-12 w-full rounded-md transition-all duration-200 hover:scale-110 hover:shadow-lg focus:ring-2 ring-offset-2";
                swatch.style.backgroundColor = `rgb(${theme.rgb})`;
                swatch.style.boxShadow = `0 0 15px rgba(${theme.rgb}, 0.5)`;
                swatch.style.ringColor = `rgb(${theme.rgb})`;
                swatch.style.ringOffsetColor = `var(--bg-color)`;
                swatch.title = theme.name;
                // 使用 addEventListener 動態綁定事件，避免 onclick 的潛在問題
                swatch.addEventListener('click', () => changeTheme(theme));
                themeGrid.appendChild(swatch);
            });
            console.log("[DEBUG] 主題樣本已生成。");
        }
        
        // --- 數據與計時邏輯 ---
        /**
         * 更新週年計時顯示。
         */
        function updateTiming() {
            const timingElement = document.getElementById('timing');
            if (!timingElement) {
                console.warn("[WARN] 未找到 UI 元素 'timing' 以進行 updateTiming。跳過。");
                return;
            }

            const start = new Date(CONFIG.START_DATE);
            const now = new Date();
            const elapsedMs = now.getTime() - start.getTime();

            const elapsedDays = (elapsedMs / (1000 * 60 * 60 * 24)).toFixed(3);
            const totalSeconds = Math.floor(elapsedMs / 1000);
            const elapsedHours = Math.floor(totalSeconds / 3600);
            const elapsedMinutes = Math.floor((totalSeconds % 3600) / 60);
            const elapsedSeconds = totalSeconds % 60;
            
            const formatDate = (d) => `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
            
            // 幫助函數：根據固定天數間隔獲取下一個週年日期
            const getNextAnniversary = (baseDate, days) => {
                let count = 0, nextDate;
                do { 
                    count++; 
                    nextDate = new Date(baseDate.getTime() + count * days * 24 * 60 * 60 * 1000); 
                } while (nextDate < now);
                return { date: nextDate, count };
            };
            
            // 幫助函數：獲取下一個年度週年日期
            const getNextYearly = (baseDate) => {
                let count = 0, nextDate;
                do { 
                    count++; 
                    nextDate = new Date(baseDate); 
                    nextDate.setFullYear(baseDate.getFullYear() + count); 
                } while (nextDate < now);
                return { date: nextDate, count };
            };
            
            const next100 = getNextAnniversary(new Date(CONFIG.START_DATE), 100);
            const next180 = getNextAnniversary(new Date(CONFIG.START_DATE), 180);
            const next300 = getNextAnniversary(new Date(CONFIG.START_DATE), 300);
            const nextYear = getNextYearly(new Date(CONFIG.START_DATE));
            
            timingElement.innerHTML = `<ul>
                <li>Bunny CC 已與吾等共度 ${elapsedDays} 太陽週期。</li>
                <li>下個百年標記: ${formatDate(next100.date)} (週期 ${next100.count})。</li>
                <li>下個 180 日標記: ${formatDate(next180.date)} (週期 ${next180.count})。</li>
                <li>下個 300 日標記: ${formatDate(next300.date)} (週期 ${next300.count})。</li>
                <li>下個星辰年標記: ${formatDate(nextYear.date)} (第 ${nextYear.count} 年)。</li>
                <li>逝去時光: ${elapsedHours}時 ${elapsedMinutes}分 ${elapsedSeconds}秒。</li>
            </ul>`;
        }
        
        /**
         * 從 JSON 文件加載寵物記錄並處理以用於顯示和圖表。
         * 現在使用 content_fetcher 來加載上傳的文件。
         */
        async function loadAndProcessData() {
            console.log("[DEBUG] 開始數據加載與處理。");
            const allRecordsContainer = document.getElementById('all-records-container');
            if (!allRecordsContainer) {
                console.error("[ERROR] 未找到所有記錄容器元素以進行數據加載。");
                return;
            }

            // 顯示加載訊息
            allRecordsContainer.innerHTML = `<p class="text-center text-xl" style="color: var(--text-muted-color);">啟動寵物檔案檢索中...請稍候。</p>`;

            try {
                // 使用 content_fetcher 來加載上傳的文件
                const recordsText = await content_fetcher.fetch({
                    query: CONFIG.PET_RECORDS_FETCH_ID,
                    source_references: [{ id: CONFIG.PET_RECORDS_FETCH_ID, type: 'FILE' }]
                });
                const records = JSON.parse(recordsText);
                console.log('[DEBUG] 已加載並解析寵物記錄數據:', records);
                
                // 處理所有記錄: 轉換時間戳並添加 31 年偏移
                allRecordsData = records.map(r => {
                    // 確保 r.date 是數字並轉換為毫秒
                    const dateTimestamp = typeof r.date === 'number' ? Math.floor(r.date) : Date.parse(r.date) / 1000;
                    const d = new Date(dateTimestamp * 1000); 
                    d.setFullYear(d.getFullYear() + 31); // 添加 31 年偏移 (根據用戶之前的代碼)
                    return { ...r, processedDate: d };
                }).sort((a, b) => b.processedDate.getTime() - a.processedDate.getTime()); // 降序排序以供顯示

                // 過濾體重圖表數據 - 注意這裡的 '体重测量'
                weightChartData = records
                    .filter(r => r.activity === '体重测量' && typeof r.weight === 'number' && r.weight > 0)
                    .map(r => {
                        const dateTimestamp = typeof r.date === 'number' ? Math.floor(r.date) : Date.parse(r.date) / 1000;
                        const d = new Date(dateTimestamp * 1000);
                        d.setFullYear(d.getFullYear() + 31);
                        return { date: d, weight: r.weight };
                    })
                    .sort((a, b) => a.date.getTime() - b.date.getTime()); // 升序排序以供圖表按時間順序顯示

                renderAllRecords();
                renderWeightChart();
                console.log("[DEBUG] 數據加載與處理完成。");

            } catch (error) {
                console.error("[ERROR] 數據加載錯誤:", error);
                allRecordsContainer.innerHTML = `<p class="text-red-400 text-center">錯誤: 檔案檢索失敗。請查閱日誌。</p>`;
            }
        }

        /**
         * 在列表容器中渲染所有寵物記錄。
         */
        function renderAllRecords() {
            console.log("[DEBUG] 渲染所有記錄。");
            const allRecordsContainer = document.getElementById('all-records-container');
            if (!allRecordsContainer) return;

            allRecordsContainer.innerHTML = allRecordsData.map(rec => {
                const dateStr = rec.processedDate.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
                return `<div class="p-3 rounded-md" style="background: rgba(var(--glow-rgb), 0.05); border-left: 3px solid rgba(var(--glow-rgb), 0.5)">
                            <div class="flex justify-between items-center">
                                <strong class="font-bold glow-text text-sm">活動: ${rec.activity}</strong>
                                <time class="text-xs" style="color:var(--text-muted-color)">時間標記: ${dateStr}</time>
                            </div>
                            <p class="mt-1" style="color: var(--text-color)">筆記: ${rec.notes || '無'}</p>
                        </div>`;
            }).join('');
            // 如果沒有記錄，顯示一條訊息
            if (allRecordsData.length === 0) {
                allRecordsContainer.innerHTML = `<p class="text-center text-xl text-gray-500 mt-8">在此檔案中未找到任何記錄。</p>`;
            }
            console.log("[DEBUG] 所有記錄已渲染。");
        }

        /**
         * 渲染體重變化圖表。
         */
        function renderWeightChart() {
            console.log("[DEBUG] 渲染體重圖表。");
            const weightChartCanvas = document.getElementById('weightChart');
            const weightChangeInfo = document.getElementById('weight-change-info');

            if (!weightChartCanvas) {
                console.error("[ERROR] 未找到體重圖表畫布元素以進行渲染。");
                return;
            }

            if (weightChart) {
                weightChart.destroy(); // 銷毀現有圖表實例
                console.log("[DEBUG] 現有圖表已銷毀。");
            }

            if (!weightChartData.length) {
                weightChartCanvas.style.display = 'none';
                if (weightChangeInfo) weightChangeInfo.innerHTML = `<p class="text-yellow-400">未檢測到質量數據。</p>`;
                console.log("[DEBUG] 沒有體重數據可渲染圖表。");
                return;
            } else {
                weightChartCanvas.style.display = 'block';
                if (weightChangeInfo) weightChangeInfo.innerHTML = `<p class="text-gray-400">點擊數據點以進行質量波動分析。</p>`;
            }
            
            const ctx = weightChartCanvas.getContext('2d');
            const style = getComputedStyle(document.documentElement);
            const primaryColor = `rgb(${style.getPropertyValue('--glow-rgb').trim()})`;
            const textColor = style.getPropertyValue('--text-muted-color').trim();
            const gridColor = `rgba(${style.getPropertyValue('--glow-rgb').trim()}, 0.1)`;

            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    // 標籤是簡單的日期字符串，而不是 'time' 刻度的 Date 對象
                    labels: weightChartData.map(d => d.date.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' })),
                    datasets: [{
                        label: '質量 (g)',
                        data: weightChartData.map(d => d.weight),
                        borderColor: primaryColor,
                        backgroundColor: `rgba(${style.getPropertyValue('--glow-rgb').trim()}, 0.2)`,
                        borderWidth: 2,
                        pointBackgroundColor: primaryColor,
                        pointBorderColor: 'var(--bg-color)',
                        pointRadius: 4,
                        pointHoverRadius: 7,
                        tension: 0.4,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: { // 自定義工具提示樣式
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + 'g';
                                        const currentIndex = context.dataIndex;
                                        // 計算與前一個點的差異
                                        if (currentIndex > 0) {
                                            const previousWeight = context.dataset.data[currentIndex - 1];
                                            const currentWeight = context.parsed.y;
                                            const difference = currentWeight - previousWeight;
                                            label += ` (增量: ${difference >= 0 ? '+' : ''}${difference.toFixed(1)}g)`;
                                        }
                                    }
                                    return label;
                                }
                            },
                            titleFont: { family: "'Noto Sans SC', sans-serif" }, // 工具提示使用 Noto Sans
                            bodyFont: { family: "'Noto Sans SC', sans-serif" },
                            padding: 10,
                            boxPadding: 5,
                            displayColors: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            borderColor: primaryColor,
                            borderWidth: 1,
                            cornerRadius: 5,
                        }
                    },
                    scales: {
                        y: { 
                            grid: { color: gridColor, drawBorder: false }, 
                            ticks: { color: textColor, font: { family: "'Noto Sans SC', sans-serif" }} 
                        },
                        x: { 
                            grid: { display: false }, 
                            ticks: { color: textColor, font: { family: "'Noto Sans SC', sans-serif" }} 
                        }
                    }
                    ,
                    onClick: (event, elements) => {
                        if (elements.length > 0 && weightChangeInfo) { // 確保元素存在
                            const index = elements[0].index;
                            if (index > 0) {
                                const diff = weightChartData[index].weight - weightChartData[index - 1].weight;
                                const sign = diff >= 0 ? '+' : '';
                                const color = diff >= 0 ? 'text-lime-400' : 'text-red-400';
                                weightChangeInfo.innerHTML = `<p>增量: <span class="font-bold ${color}">${sign}${diff.toFixed(1)}g</span></p>`;
                            } else {
                                weightChangeInfo.innerHTML = `<p>初始質量掃描。</p>`;
                            }
                        }
                    }
                }
            });
            console.log("[DEBUG] 體重圖表已渲染。");
        }

        // --- 遊走兔動畫邏輯 ---
        function animateRabbit() {
            if (!wanderingRabbit) {
                console.warn("[WARN] 未找到遊走兔元素，停止動畫。");
                return;
            }

            const speed = 2.5 * animationSpeedMultiplier; 
            
            // 從 transform 獲取當前位置
            const style = window.getComputedStyle(wanderingRabbit);
            const transform = style.transform || style.webkitTransform || style.mozTransform;
            let currentRabbitX = 0, currentRabbitY = 0;

            if (transform && transform !== 'none') {
                const matrix = new DOMMatrix(transform);
                currentRabbitX = matrix.m41;
                currentRabbitY = matrix.m42;
            } else {
                // 對不支持 style.transform 的 DOMMatrix 或 transform 尚未設置的瀏覽器進行回退。
                // 這裡我們需要解析當前樣式而不是依賴於 prevX/prevY
                currentRabbitX = parseFloat(wanderingRabbit.style.transform.match(/translateX\(([^)]+)px\)/)?.[1] || '0');
                currentRabbitY = parseFloat(wanderingRabbit.style.transform.match(/translateY\(([^)]+)px\)/)?.[1] || '0');
            }


            // 如果目標未定義或兔子靠近目標，設置一個新的隨機目標
            if (targetX === undefined || targetY === undefined || 
                Math.sqrt(Math.pow(targetX - currentRabbitX, 2) + Math.pow(targetY - currentRabbitY, 2)) < speed) { 
                targetX = Math.random() * (window.innerWidth - wanderingRabbit.offsetWidth); 
                targetY = Math.random() * (window.innerHeight - wanderingRabbit.offsetHeight); 
            }
            
            const prevX = currentRabbitX; // 儲存兔子移動前的位置用於掉落物
            const prevY = currentRabbitY;

            const distanceX = targetX - currentRabbitX;
            const distanceY = targetY - currentRabbitY; // 修正：應使用 currentRabbitY
            const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);

            if (distance > 0) { // 只有當存在距離時才移動
                currentX = currentRabbitX + (distanceX / distance) * speed;
                currentY = currentRabbitY + (distanceY / distance) * speed;
            } else { // 如果已經到達目標，則停留或重新計算 (由上面的條件處理)
                currentX = targetX;
                currentY = targetY;
            }

            // 將位置限制在邊界內
            currentX = Math.max(0, Math.min(currentX, window.innerWidth - wanderingRabbit.offsetWidth)); 
            currentY = Math.max(0, Math.min(currentY, window.innerHeight - wanderingRabbit.offsetHeight)); 

            wanderingRabbit.style.transform = `translate(${currentX}px, ${currentY}px)`;

            if (performance.now() - lastDropTime > DROP_INTERVAL_MS) {
                const dropping = droppingsPool[currentDroppingIndex];
                if (dropping) { 
                    dropping.style.left = `${prevX + (wanderingRabbit.offsetWidth - 6) / 2}px`; 
                    dropping.style.top = `${prevY + (wanderingRabbit.offsetHeight - 6) / 2 + 10}px`;  
                    
                    dropping.classList.remove('fade-out');
                    void dropping.offsetWidth; // 觸發重排以重新開始動畫
                    dropping.classList.add('fade-out');

                    currentDroppingIndex = (currentDroppingIndex + 1) % MAX_DROPPINGS;
                    lastDropTime = performance.now();
                }
            }
            window.requestAnimationFrame(animateRabbit);
        }

        // --- 更新日誌填充 ---
        function populateChangelog() {
            console.log("[DEBUG] 填充更新日誌。");
            const changelogList = document.getElementById('changelog-list');
            if (!changelogList) {
                console.error("[ERROR] 未找到更新日誌列表元素以填充。");
                return;
            }
            const changelogContent = `
                <h4>✨ v8.0.1 - 🐛 Bug Fix Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>修正之錄 (The Maladies Vanquished!):</strong></p>
                    <ul>
                        <li><span style="color: red;"><strong>Edge 瀏覽器執行錯誤已修正！</strong></span> 移除 HTML 中所有 <code>onclick</code> 屬性，改為在 JavaScript 中使用 <code>addEventListener</code> 動態綁定事件，解決了 <code>Uncaught SyntaxError: Unexpected identifier 'addEventListener'</code> 和 <code>Uncaught ReferenceError: toggleModal is not defined</code> 等問題。</li>
                        <li><span style="color: red;"><strong>體重圖表數據載入已修正！</strong></span> 將體重數據篩選的活動名稱從 '體重測量' (繁體) 修正為 '体重测量' (簡體)，確保正確載入並顯示來自 <code>PetRecords.json</code> 的體重數據。</li>
                        <li><code>content_fetcher</code> 模組引入錯誤已修正。現在直接使用全域的 <code>content_fetcher</code> 物件，不再嘗試透過 <code>import</code> 引入。</li>
                        <li>遊走兔動畫路徑邏輯已微調，使其移動更加平滑。</li>
                    </ul>
                </div>
                <h4>✨ v8.0.0 - 🐇 Arcane Chronos Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>新增之光 (A Light Newly Cast!):</strong></p>
                    <ul>
                        <li>時光之軸，流轉不息：已將遊走兔之靈動動畫重啟，其步履輕盈，蹤跡可循，似映照百二幀之華彩，為此檔案添得無限生機。</li>
                        <li>虹彩之譜，廣納天地：主題色彩之選已擴至五十六種，每色皆為靈光，任君採擷，以妝點此檔案之華美外衣。</li>
                        <li>術數之奧，洞悉性能：性能探測之法已然精進，現可揭示瀏覽器之細語、記憶之深淺、網絡之脈動，然 CPU 與 GPU 之秘，以及 IP 位址之蹤，仍隱於天機，非凡俗可窺。</li>
                        <li>古籍新生，筆墨留香：此更新之編年史，已用莎翁之筆觸重撰，字句之間，盡顯古雅與深邃，願為閱讀者帶來一場詞藻之盛宴。</li>
                        <li>始頁標記，終端之靈：頁首之「Presented by CanguroMIO & Bunny CC Joint Archives」字樣，已改為終端命令提示之風，令此檔案更具科技之韻。</li>
                    </ul>
                    <p><strong>優化之篇 (An Ode to Refinement!):</strong></p>
                    <ul>
                        <li>數據流轉，無礙暢行：核心數據處理及頁面元素交互之機制，已回歸至舊版之堅實基礎，確保所有邏輯如昔日般，流暢無礙，運行無疵。</li>
                    </ul>
                    <p><strong>修正之錄 (The Maladies Vanquished!):</strong></p>
                    <ul>
                        <li>往昔之困，盡皆消弭：此前諸般運行之舛誤，如「Unexpected identifier 'addEventListener'」及「window.toggleModal is not a function」等，皆已於此版中徹底根除，檔案已臻穩定之境。</li>
                    </ul>
                </div>
                <h4>✨ v7.0.1 - 🌌 Cosmic Symphony Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>A grand decree for Chronological Scrolls: Each sagacious update, henceforth, shall reside within its own hallowed frame, distinctly marked for ease of contemplation and historical traverse.</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The arcane glyphs and solitary marks, which once obscured the pristine pronouncements within these chronicles, have been expunged, that truth may shine unblemished, free from the shackles of superfluous punctuation.</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>A whisper of correction for the Temporal Weaver, ensuring the epochal calculations remain true, unaffected by the whispers of future dawns.</li>
                    </ul>
                </div>
                <h4>✨ v7.0.0 - 🌠 Luminous Fusion Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Visage's Interplay now Heightened: Upon the mouse's approach, the Pac-Man's maw doth gape with greater vigour, and a radiant flash illuminates the portrait's bounds, thereby elevating the interactive marvel.</li>
                        <li>The Canvas of Aetherial Radiance now Adorned: The web's backdrop embraceth a dynamic radial gradient, its hues meticulously woven with the chosen theme's palette, shifting subtly as if breathing, thus forging a deeper, more artistic vista.</li>
                        <li>The Errant Hare's Gambol now Flows with Fluid Grace: The elusive rabbit's peregrinations across the display, once plagued by stuttering, now proceed with an unblemished rhythm, infusing the archive with newfound vivacity.</li>
                        <li>Universal Accord for Digital Scrolls: The interface's harmony across all digital realms, from the venerable Edge to the swift Chrome, and adapting to screens of manifold sizes, hath been fortified, ensuring an impeccable and beauteous presentation.</li>
                        <li>The Lexicon and Chroma Elevated: The primary script now rendered in Noto Sans SC for clarity's sake, granting the gaze an unobstructed passage through knowledge. Furthermore, our chromatic repertoire hath expanded by five, presenting a grand total of twenty vibrant themes, inviting the connoisseur to adorn the archive in a vestment of light and shade.</li>
                    </ul>
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>The Oracle of Performance now stands Revealed! A button, newly forged, doth summon forth a tableau revealing the browser's vital humours, specifically its memory's embrace, thereby granting insight into the digital essence's consumption.</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Chronicle of Changes, once shrouded in silence, now Unfurls in its Entirety. The malady of blank entries hath been utterly dispelled, and the annals of transformation stand complete, preserving every epochal shift.</li>
                    </ul>
                </div>

                <h4>✨ v6.0.0 - 🌌 KaleidoDust Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Visage's Interplay now Heightened: Upon the mouse's approach, the Pac-Man's maw doth gape with greater vigour, and a radiant flash illuminates the portrait's bounds, thereby elevating the interactive marvel.</li>
                        <li>The Canvas of Aetherial Radiance now Adorned: The web's backdrop embraceth a dynamic radial gradient, its hues meticulously woven with the chosen theme's palette, shifting subtly as if breathing, thus forging a deeper, more artistic vista.</li>
                        <li>The Errant Hare's Gambol now Flows with Fluid Grace: The elusive rabbit's peregrinations across the display, once plagued by stuttering, now proceed with an unblemished rhythm, infusing the archive with newfound vivacity.</li>
                        <li>Universal Accord for Digital Scrolls: The interface's harmony across all digital realms, from the venerable Edge to the swift Chrome, and adapting to screens of manifold sizes, hath been fortified, ensuring an impeccable and beauteous presentation.</li>
                        <li>The Lexicon and Chroma Elevated: The primary script now rendered in Noto Sans SC for clarity's sake, granting the gaze an unobstructed passage through knowledge. Furthermore, our chromatic repertoire hath expanded by five, presenting a grand total of fifteen vibrant themes, inviting the connoisseur to adorn the archive in a vestment of light and shade.</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Chronicle of Changes, once shrouded in silence, now Unfurls in its Entirety. The malady of blank entries hath been utterly dispelled, and the annals of transformation stand complete, preserving every epochal shift.</li>
                    </ul>
                </div>

                <h4>✨ v5.0.0 - 💫 Kinetic Glint Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Visage's Interplay now Heightened: Upon the mouse's approach, the Pac-Man's maw doth gape with greater vigour, and a radiant flash illuminates the portrait's bounds, thereby elevating the interactive marvel.</li>
                        <li>The Errant Hare's Gambol now Flows with Fluid Grace: The elusive rabbit's peregrinations across the display, once plagued by stuttering, now proceed with an unblemished rhythm, infusing the archive with newfound vivacity.</li>
                        <li>Universal Accord for Digital Scrolls: The interface's harmony across all digital realms, from the venerable Edge to the swift Chrome, and adapting to screens of manifold sizes, hath been fortified, ensuring an impeccable and beauteous presentation.</li>
                        <li>The Lexicon and Chroma Elevated: The primary script now rendered in Noto Sans SC for clarity's sake, granting the gaze an unobstructed passage through knowledge. Furthermore, our chromatic repertoire hath expanded by five, presenting a grand total of fifteen vibrant themes, inviting the connoisseur to adorn the archive in a vestment of light and shade.</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Chronicle of Changes, once shrouded in silence, now Unfurls in its Entirety. The malady of blank entries hath been utterly dispelled, and the annals of transformation stand complete, preserving every epochal shift.</li>
                    </ul>
                </div>

                <h4>✨ v4.0.0 - ✨ Pixel Evolution Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>The Chromatic Vault now Expanded: Five additional palettes of theme now grace our repertoire, offering a richer tapestry of visual choices.</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Visage's Frame now Perfect: The Pac-Man's border, which once obscured a portion of the noble image, hath been meticulously adjusted, ensuring the portrait's pristine and complete presentation.</li>
                        <li>The Hare's Motion now Flows with Greater Artistry: The elusive rabbit's wandering animated dance hath been refined, its movements rendered with a newfound fluidity, and the vexing impediment to its journey upon certain browsers hath been vanquished.</li>
                        <li>The Responsive Layout, a Bastion of Strength! The interface's adaptability across diverse digital realms, especially the challenging Edge, and screens of manifold dimensions, hath been fortified, ensuring the content's unblemished display.</li>
                        <li>The Lexicon now a Native Tongue! The core script is now rendered in Noto Sans SC for clarity's sake, granting the gaze an unobstructed passage through knowledge. Furthermore, our chromatic repertoire hath expanded by five, presenting a grand total of fifteen vibrant themes, inviting the connoisseur to adorn the archive in a vestment of light and shade.</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Chronicle of Changes, once a Canvas of Void, now Pulsates with the Echoes of History! The malady of absent entries hath been utterly dispelled, and the full parchment of transformations, from the earliest whispers to the latest pronouncements, now stands revealed.</li>
                    </ul>
                </div>

                <h4>✨ v3.0.0 - 🔄 Core Rollback Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>A Grand Tableau in the Spirit of TRON now Unfurls! Behold, the interface, reborn from the very essence of the working code, embraceth the luminous glow, the vector's sharp line, and the dynamic raster's dance, adorning the archives with a fresh, digital majesty!</li>
                        <li>The Hare's Return! The endearing, wandering rabbit, along with the charming chocolate bean footprints it leaves in its wake, hath been reinstated, imbuing the archive's scroll with renewed vitality and playful spirit!</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Core of Data Retrieval now Mended! The very mechanism by which the PetRecords.json archive doth yield its secrets hath been fortified, ensuring a steadfast transfer and a flawless display within the archive's lists, thereby banishing the phantom of absent data!</li>
                        <li>The Buttons' Response, now in Full Accord! All interactive glyphs, including those for the Chronicle of Changes, the Palette's Dial, and the Full-Screen's Dominion, now respond with the precise and unwavering logic inherited from the working code, no longer mute to your esteemed commands!</li>
                        <li>The Chronological Chart's Dates, now Succinct! The reliance upon date-fns and chartjs-adapter-date-fns hath been gracefully retired. The browser's native wisdom now formats the chart's temporal axis, thus dispelling past vexations concerning 'dateFns' being an unknown entity. This doth render the graphical display more stable and free from encumbrances!</li>
                        <li>The Elements' Grasp, Perfected in Time! The acquisition of all digital components (by means of document.getElementById) hath been meticulously orchestrated to occur only upon the full and proper loading of the page's fabric (within the DOMContentLoaded event), thereby eradicating the troublesome 'Cannot set properties of null' errors at their root!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Script's Structure, now a Clear Tapestry! The JavaScript's arcane verses have been modularized and adorned with sagacious commentaries, rendering them more comprehensible and amenable to future stewardship.</li>
                        <li>Enhanced Foresight of Error! In the crucible of vital operations, additional pronouncements to the console have been inscribed, along with robust validations, aiding in the swift discernment of any burgeoning anomaly.</li>
                    </ul>
                </div>

                <h4>✨ v2.1.2 - 🛠️ Code Refactor Bunny</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Elements' Grasp now Timely Calibrated! All invocations of document.getElementById have been meticulously placed within the window.onload event's embrace, ensuring the digital components are secured only when the document's structure is fully erect, thereby vanquishing the 'Cannot set properties of null' error.</li>
                        <li>The Temporal Adapter, now Autonomously Awakened! The manual impositions upon Chart.js's date adapter have been rescinded, allowing chartjs-adapter-date-fns to register its arcane knowledge automatically upon its loading, thus mending the 'dateFns is not defined' vexation.</li>
                        <li>The Data's Path, now Precisely Charted! The loading trajectory for PetRecords.json hath been restored to its rightful course, in harmony with the working code, ensuring the flawless revelation of information.</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>A Mightier Scrutiny of Malady! Additional examinations and chronicle entries to the console have been infused, rendering the pursuit of anomalies a more facile endeavour!</li>
                    </ul>
                </div>

                <h4>✨ v2.1.1 - ✨ Element Locator Bunny</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Core Elements, now in their Rightful Place! The discord of mismatched DOM element identifiers (such as profile-pic and all-records-container) hath been utterly rectified. The JavaScript now doth find them with unerring precision, and the archive's display is no longer a desolate void!</li>
                        <li>The Weight's Shifting Oracle, now Returned! The informational prompt for weight fluctuations, once mysteriously absent, hath been reinstated, ensuring that the interactive feedback of corporeal data is no longer shrouded in enigma!</li>
                        <li>The Archive's Lore, miraculously restored! The sacred PetRecords.json data, by means of the content_fetcher, now doth load with steadfast reliability, banishing the specter of 'Cannot set properties of null'!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Scrutiny's Arcana, Elevated! Additional chronicles to the console have been inscribed, enabling us, like master sleuths, to trace the currents of data and the states of elements, leaving no anomaly unrevealed!</li>
                    </ul>
                </div>

                <h4>✨ v2.1.0 - 💫 Quantum Leap Bunny</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>A New Epoch now Commenceth! The version's numeral and its chosen appellation hath undergone a quantum leap of epic proportion, bringing forth a new identification imbued with the spirit of the future and whimsical charm! Doth not the archive now feel as though it hath traversed dimensions?</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Archive's Lore, miraculously restored! The dreadful 'Cannot set properties of null (setting 'innerHTML')' malady hath been utterly vanquished! The lists of lore now load with unwavering stability, and the sacred data no longer absconds into the ether!</li>
                        <li>The DOM Elements' Alignment, now perfect! The JavaScript's references to the vital components of the interface (such as profile-pic and all-records-container) now align with unerring precision to their counterparts within the HTML, henceforth ensuring that no entity doth mistake another!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>A Seamless Interplay of Visage! All the pixelated artistry of the interface, the dynamic themes, and the endearing, wandering rabbit's animated dance, remain fully preserved, allowing you, even amidst the vanquishing of errors, to luxuriate in a visual feast!</li>
                    </ul>
                </div>

                <h4>✨ v2.0.0 - Stable Sync Rabbit V1.0</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Archive's Lore, miraculously restored! The dreadful 'Cannot set properties of null (setting 'innerHTML')' malady hath been utterly vanquished! The lists of lore now load with unwavering stability, and the sacred data no longer absconds into the ether!</li>
                        <li>The DOM Elements' Alignment, now perfect! The JavaScript's references to the vital components of the interface (such as profile-pic and all-records-container) now align with unerring precision to their counterparts within the HTML, henceforth ensuring that no entity doth mistake another!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>A Seamless Interplay of Visage! All the pixelated artistry of the interface, the dynamic themes, and the endearing, wandering rabbit's animated dance, remain fully preserved, allowing you, even amidst the vanquishing of errors, to luxuriate in a visual feast!</li>
                    </ul>
                </div>

                <h4>✨ v2.0.0 - Pixel-Style Reversion Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>The Soul of Yesteryear now summoned! The very essence of v1.3.11's pixelated interface, its dynamic themes, and our most cherished wandering rabbit's animated dance, hath been fully invoked! Doth it not feel as though one hath traversed time to the epoch of classic arcade machines?</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Chart's Mystical Stability! Even as the archive's visage underwent a grand metamorphosis, the Chart.js's temporal enchantment (its axis of time, its data points' revelation) remained as steadfast as the mountains, more stable than a scholar's steadfast gaze!</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Discord of Time, now harmonized! The loading mechanisms of date-fns and chartjs-adapter-date-fns have been fortified with an ironclad resolve. The chart's temporal tapestry shall no longer stray from its designated path, and never again shalt thou accuse us of 'memory leakage'!</li>
                        <li>The Little Hare's Return! The wandering pixelated rabbit hath been reanimated with renewed vigour, for an archive devoid of its playful gambols is, verily, no Bunny CC Archive at all!</li>
                    </ul>
                </div>

                <h4>🌟 v2.0.0 - Pixel Sync Rabbit V2.0</h4>
                <div class="changelog-entry">
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Interface's Burden, now wondrously enhanced! The most recent pixelated visage and the very controls for chromatic shifting have been seamlessly interwoven, allowing the transformation of appearance to be as effortless as the changing of a hero's guise in a grand saga, a task one cannot desist from!</li>
                        <li>The Temporal Axis's Distortion, now rectified! The Chart.js's mystical temporal axis hath been firmly stabilized, ensuring that the chronicles of corporeal mass are unveiled with crystalline clarity, never again to resemble a quantum enigma!</li>
                    </ul>
                    <p><strong>Removals (Banished to Oblivion!):</p>
                    <ul>
                        <li>Superfluous Runes of Enchantment, now expunged! The redundant components of the interface and their corresponding controls have been purged, for we are practitioners of elegant brevity! The wandering rabbit, too, hath been granted a temporary respite, that space might be made for the advent of the new visage!</li>
                    </ul>
                </div>

                <h4>🚀 v2.0.0 - Pixel Sync Rabbit V1.0</h4>
                <div class="changelog-entry">
                    <p><strong>Additions (A New Decree Hath Been Issued!):</p>
                    <ul>
                        <li>The Date's Arcane Adaptation! For the first time, date-fns and chartjs-adapter-date-fns unite in a grand conjuration, empowering the Chart.js's temporal axis to decipher the chronology with unerring precision, thereby banishing the spectre of 'undefined properties'!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Chart's Temporal Axis, now calibrated! The X-axis of Chart.js hath been declared of the 'time' type, ensuring the chronological display is of utmost exactitude, lest a single increment of Bunny CC's growth be lost to obscurity!</li>
                    </ul>
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Abyss of Dependencies, now redeemed! The very order of the arcane libraries' invocation hath been meticulously adjusted, ensuring that every magical component doth arrive at its appointed hour, thereby circumventing the ignominious plight of 'function not found'!</li>
                    </ul>
                </div>

                <h4>🛡️ v1.3.11 - Compatibility Stability Rabbit V1.0</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Enigma of Error, now dispelled! The mysterious affliction where the Chart.js date adapter failed to discern the 'startOfDay' function from date-fns hath been resolved. It now, with utmost docility, doth retrieve the correct arcane knowledge from 'unpkg.com', no longer prone to vexatious fits!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Arcana of Diagnosis, elevated! Further chronicles of diagnostic insight have been inscribed following the loading rituals, aiding us, like seasoned investigators, in tracking the precise arrival of each magical element.</li>
                    </ul>
                </div>

                <h4>⏪ v1.3.10 - Adapter Enhancement Rabbit V2.2</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Temporal Reversion, accomplished! The date-fns library, by a deliberate act of will, hath been rolled back to version 2.25.0. Yea, we confess that at times, the ancient ways hold more potency, akin to thine venerable gaming console! This act doth mend the 'startOfDay' error, ensuring enduring harmony.</li>
                    </ul>
                </div>

                <h4>⚡ v1.3.9 - Adapter Enhancement Rabbit V2.1</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Pre-Emptive Incantation, uttered! The sacred verses for registering the date-fns adapter have been invoked with greater haste. Now, Chart.js, ere it requires them, doth find all necessary temporal arcana, thereby banishing the loading impediments with perfect efficacy.</li>
                    </ul>
                </div>

                <h4>🔄 v1.3.8 - Adapter Enhancement Rabbit V2.0</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Explicit Command, issued! The date-fns hath been, with clarity, declared unto Chart.js as its appointed temporal adapter. Henceforth, Chart.js shall feign no ignorance of date-fns's very existence!</li>
                    </ul>
                </div>

                <h4>🔗 v1.3.7 - Script Sync Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Orchestration of Arcane Overtures, now perfected! The very sequence of Chart.js, date-fns, and chartjs-adapter-date-fns's invocation hath been meticulously arranged. For like a grand orchestra, each instrument must play its part in its appointed moment, that a symphony most perfect may resound!</li>
                    </ul>
                </div>

                <h4>🗺️ v1.3.6 - Path Calibration Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Lost Archive, now Guided Home! The very trajectory for the loading of the PetRecords.json archive hath been corrected. Henceforth, it shall unerringly find its abode within 'dist/bunnycc/PetRecords.json', no longer condemned to wander the digital wastes.</li>
                    </ul>
                </div>

                <h4>✨ v1.3.5 - Adaptation Enhanced Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Chart's Provisions, now served in due course! The initialization of the Chart.js graph and the infusion of its data have been sundered into two distinct rites, akin to preparing the feast's vessels ere the courses are presented, thereby rendering the process more fluid and robust.</li>
                        <li>The Dates' Visage, now rendered comely! The chronicles of time within both the chart and the register's scrolls now bear only the year, month, and day, thereby achieving a clarity most succinct, as if retaining only the most svelte of portraits!</li>
                        <li>The Archive's Transference, now restored! The fetching of the PetRecords.json archive hath been re-instituted and its handling of unforeseen adversities fortified. Now, the transfer of data doth proceed with the speed and security of a swift carriage upon a highway!</li>
                        <li>The Perilous Links, now severed! The external connections that once whispered of mixed content, thereby conjuring vexatious warnings, have been expunged. For safety is paramount, lest unwelcome specters be drawn to our digital hearth!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>Tailwind's Sagacious Admonition! Further notes concerning the deployment of Tailwind CSS CDN have been inscribed, serving as a reminder for the vigilant considerations required in the grand theatre of production.</li>
                    </ul>
                </div>

                <h4>📐 v1.3.4 - Data Correction Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Temporal Seals, now precisely rectified! Ere the epochal markers are transmuted into Date objects, their fractional whispers shall be silenced and their essence rendered into whole milliseconds, that time may never again be shrouded in ambiguity!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Detective's Chronicle, now replete with detail! Further chronicles to the console have been inscribed, facilitating the discerning analysis of anomalies during the transmutation of time and the genesis of the Chart.js.</li>
                    </ul>
                </div>

                <h4>🪐 v1.3.3 - Data Spacetime Stabilizer Rabbit</h4>
                <div class="changelog-entry">
                    <p><strong>Fixes (The Vexing Maladies Vanquished!):</p>
                    <ul>
                        <li>The Data, eternally enshrined! To ensure the unwavering retrieval of JSON data, the very essence of PetRecords.json hath been embedded directly into the JavaScript verses of the HTML script. Now, the data, like a relic sealed within a crystal sphere, remains steadfast and incorruptible!</li>
                    </ul>
                    <p><strong>Optimizations (Improvements of Noble Bearing!):</p>
                    <ul>
                        <li>The Scrutiny's Footprints, now more numerous! Further chronicles to the console have been inscribed, thereby rendering the pursuit of anomalies during the transmutation of data and the genesis of the Chart.js with greater clarity.</li>
                    </ul>
                </div>
            `;
            changelogList.innerHTML = changelogContent;
            console.log("[DEBUG] 更新日誌已填充。");
        }

        /**
         * 設置所有 UI 按鈕的事件監聽器。
         * 這是為了解決 `Uncaught SyntaxError: Unexpected identifier 'addEventListener'` 錯誤。
         */
        function setupEventListeners() {
            console.log("[DEBUG] 設置事件監聽器。");
            document.getElementById('changelog-btn')?.addEventListener('click', () => toggleModal('changelog-modal'));
            document.getElementById('theme-btn')?.addEventListener('click', () => toggleModal('theme-modal'));
            document.getElementById('performance-btn')?.addEventListener('click', () => toggleModal('performance-modal'));
            document.getElementById('fullscreen-btn')?.addEventListener('click', toggleFullscreen);

            // 模態框關閉按鈕
            document.getElementById('changelog-close-btn')?.addEventListener('click', () => toggleModal('changelog-modal'));
            document.getElementById('theme-close-btn')?.addEventListener('click', () => toggleModal('theme-modal'));
            document.getElementById('performance-close-btn')?.addEventListener('click', () => toggleModal('performance-modal'));
            
            // 性能模態框中的激活感應器按鈕
            document.getElementById('activate-sensor-btn')?.addEventListener('click', displayPerformanceMetrics);

            // 模態框疊加層點擊關閉功能 (僅當點擊疊加層本身時)
            document.getElementById('changelog-modal')?.addEventListener('click', (event) => {
                if (event.target.id === 'changelog-modal') toggleModal('changelog-modal');
            });
            document.getElementById('theme-modal')?.addEventListener('click', (event) => {
                if (event.target.id === 'theme-modal') toggleModal('theme-modal');
            });
            document.getElementById('performance-modal')?.addEventListener('click', (event) => {
                if (event.target.id === 'performance-modal') toggleModal('performance-modal');
            });

            console.log("[DEBUG] 事件監聽器已設置。");
        }


        // --- 主 window.onload 監聽器 ---
        // 使用 window.onload 以確保所有 DOM 元素在嘗試獲取其引用或附加事件監聽器之前已完全加載並可訪問。
        window.onload = function() {
            console.log("[DEBUG] window.onload 事件觸發。開始初始化...");

            // 初始化兔子元素及其位置
            wanderingRabbit = document.getElementById('wandering-rabbit');
            if (wanderingRabbit) {
                // 將 currentX, currentY 初始化為隨機起始位置
                currentX = Math.random() * (window.innerWidth - wanderingRabbit.offsetWidth); 
                currentY = Math.random() * (window.innerHeight - wanderingRabbit.offsetHeight); 
                wanderingRabbit.style.transform = `translate(${currentX}px, ${currentY}px)`;
                
                // 初始化掉落物池
                for (let i = 0; i < MAX_DROPPINGS; i++) {
                    const dropping = document.createElement('div');
                    dropping.className = 'rabbit-dropping';
                    document.body.appendChild(dropping);
                    droppingsPool.push(dropping);
                }
                console.log("[DEBUG] 兔子掉落物池已初始化。");
                window.requestAnimationFrame(animateRabbit); // 開始動畫循環
                console.log("[DEBUG] 兔子動畫已啟動。");
            } else {
                console.warn("[WARN] 未找到遊走兔元素，動畫已禁用。");
            }

            // 檢測 Safari 並調整動畫幀率以獲得感知的流暢度
            const isSafari = navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome');
            if (isSafari) {
                animationSpeedMultiplier = 1.2; 
                DROP_INTERVAL_MS = 100; 
                console.log("[DEBUG] 檢測到 Safari 瀏覽器，動畫速度已優化。");
            }

            // 設置頭像圖片源
            const profilePic = document.getElementById('profile-pic');
            if (profilePic) {
                profilePic.src = CONFIG.PROFILE_PIC_PATH;
            } else {
                console.error("[ERROR] 初始化時未找到頭像圖片元素。");
            }

            // 設置事件監聽器
            setupEventListeners();
            
            // 開始計時器更新
            setInterval(updateTiming, 100);
            console.log("[DEBUG] 計時器更新已啟動。");

            // 加載並處理數據
            loadAndProcessData();

            // 生成主題樣本
            generateThemeSwatches();

            // 添加調整大小監聽器以調整兔子動畫邊界
            window.addEventListener('resize', () => {
                if (!wanderingRabbit) return; 
                const style = window.getComputedStyle(wanderingRabbit);
                const transform = style.transform || style.webkitTransform || style.mozTransform;
                let currentRabbitX = 0, currentRabbitY = 0;

                if (transform && transform !== 'none') {
                    const matrix = new DOMMatrix(transform);
                    currentRabbitX = matrix.m41;
                    currentRabbitY = matrix.m42;
                } else {
                    currentRabbitX = parseFloat(wanderingRabbit.style.transform.match(/translateX\(([^)]+)px\)/)?.[1] || '0');
                    currentRabbitY = parseFloat(wanderingRabbit.style.transform.match(/translateY\(([^)]+)px\)/)?.[1] || '0');
                }

                currentX = Math.min(Math.max(0, currentRabbitX), window.innerWidth - wanderingRabbit.offsetWidth); 
                currentY = Math.min(Math.max(0, currentRabbitY), window.innerHeight - wanderingRabbit.offsetHeight); 
                wanderingRabbit.style.transform = `translate(${currentX}px, ${currentY}px)`;

                targetX = Math.random() * (window.innerWidth - wanderingRabbit.offsetWidth); 
                targetY = Math.random() * (window.innerHeight - wanderingRabbit.offsetHeight); 
                console.log("[DEBUG] 窗口已調整大小，兔子位置和目標已更新。");
            });

            // 填充更新日誌內容
            populateChangelog();
            
            // 設置初始隨機主題
            const initialTheme = CONFIG.THEMES[Math.floor(Math.random() * CONFIG.THEMES.length)];
            changeTheme(initialTheme);
            console.log("[DEBUG] 初始主題已設置。");
            console.log("[DEBUG] 初始化完成。");
        };
    </script>
</body>
</html>
