<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å›½å°é¹å……ç”µç«™</title>
    <script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #map { width: 100%; height: 600px; }
        .info { font-size: 14px; }
        .info img { max-width: 100px; margin-top: 5px; display: block; }
        .copy-btn { margin-top: 5px; cursor: pointer; color: blue; text-decoration: underline; }
        .nav-btn { cursor: pointer; margin: 5px; padding: 5px 10px; background: lightgray; border: none; }
        .controls { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>å…¨å›½å°é¹å……ç”µç«™</h2>
    <p>ä½œè€…: @å…”å¯å¯</p>
    <div class="controls">
        <input type="text" id="searchBox" placeholder="è¾“å…¥å…³é”®å­—æœç´¢">
        <button onclick="searchLocation()">ğŸ” æœç´¢</button>
        <button onclick="map.zoomIn()">â• æ”¾å¤§</button>
        <button onclick="map.zoomOut()">â– ç¼©å°</button>
    </div>
    <div id="map"></div>
    <script>
        var map = new AMap.Map("map", {
            center: [104.1954, 35.8617], // ä»¥ä¸­å›½ä¸­å¿ƒç‚¹ä¸ºé»˜è®¤
            zoom: 5
        });
        
        function fetchPOIData() {
            $.getJSON("https://restapi.amap.com/v3/place/text", {
                key: "f5be8cdf1391fe2323abc034220d2676",
                keywords: "å°é¹å……ç”µ",
                types: "011100|011102|011103|073000|073001|073002",
                offset: 20,
                page: 1,
                extensions: "all",
                output: "json"
            }, function(data) {
                if (data.pois && data.pois.length > 0) {
                    data.pois.forEach(function(poi) {
                        var marker = new AMap.Marker({
                            position: poi.location.split(","),
                            map: map
                        });
                        
                        var photoIndex = 0;
                        var photos = poi.photos || [];
                        
                        function updatePhotoContent() {
                            return photos.length > 0 
                                ? `<img src='${photos[photoIndex].url}' alt='å……ç”µç«™å›¾ç‰‡'><br>
                                   <button class='nav-btn' onclick='prevPhoto(${photoIndex}, ${photos.length}, "photo-${poi.id}")'>â¬…ï¸ ä¸Šä¸€å¼ </button>
                                   <button class='nav-btn' onclick='nextPhoto(${photoIndex}, ${photos.length}, "photo-${poi.id}")'>â¡ï¸ ä¸‹ä¸€å¼ </button>`
                                : "";
                        }
                        
                        var content = `<div class='info'>
                            <strong>${poi.name}</strong><br>
                            åœ°å€: ${poi.address || 'æœªçŸ¥'}<br>
                            ç”µè¯: ${poi.tel || 'æ— '}<br>
                            <span class='copy-btn' onclick='copyToClipboard("${poi.address}")'>ğŸ“‹ å¤åˆ¶åœ°å€</span><br>
                            <div id='photo-${poi.id}'>${updatePhotoContent()}</div>
                        </div>`;
                        
                        var infoWindow = new AMap.InfoWindow({ content: content });
                        marker.on("click", function() {
                            infoWindow.open(map, marker.getPosition());
                        });
                    });
                }
            });
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("åœ°å€å·²å¤åˆ¶: " + text);
            }).catch(err => {
                console.error("å¤åˆ¶å¤±è´¥", err);
            });
        }
        
        function prevPhoto(index, total, id) {
            if (index > 0) {
                index--;
                document.getElementById(id).innerHTML = updatePhotoContent();
            }
        }
        
        function nextPhoto(index, total, id) {
            if (index < total - 1) {
                index++;
                document.getElementById(id).innerHTML = updatePhotoContent();
            }
        }
        
        function searchLocation() {
            var keyword = document.getElementById("searchBox").value;
            if (keyword) {
                map.setCity(keyword);
            }
        }
        
        // è·å–å…¨å›½çš„å……ç”µç«™æ•°æ®
        fetchPOIData();
    </script>
</body>
</html>
