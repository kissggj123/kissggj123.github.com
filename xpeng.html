<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å›½å°é¹å……ç”µç«™</title>
    <script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #map { width: 100%; height: 600px; }
        .info { font-size: 14px; }
        .info img { max-width: 100px; margin-top: 5px; display: block; }
        .copy-btn { margin-top: 5px; cursor: pointer; color: blue; text-decoration: underline; }
        .nav-btn { cursor: pointer; margin: 5px; padding: 5px 10px; background: lightgray; border: none; }
        .controls { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>å…¨å›½å°é¹å……ç”µç«™</h2>
    <p>ä½œè€…: @å…”å¯å¯</p>
    <div class="controls">
        <button onclick="fetchPOIData()">åŠ è½½å……ç”µç«™</button>
        <button onclick="getUserLocation()">ğŸ“ è·å–å½“å‰å®šä½</button>
        <button onclick="map.zoomIn()">â• æ”¾å¤§</button>
        <button onclick="map.zoomOut()">â– ç¼©å°</button>
    </div>
    <div id="map"></div>
    <script>
        var map = new AMap.Map("map", {
            center: [121.47, 31.23],
            zoom: 11
        });

        function fetchPOIData() {
            $.getJSON("https://restapi.amap.com/v3/place/text", {
                key: "f5be8cdf1391fe2323abc034220d2676",
                keywords: "å°é¹å……ç”µ",
                types: "011100|011102|011103|073000|073001|073002",
                offset: 20,
                page: 1,
                extensions: "all",
                output: "json"
            }).done(function(data) {
                if (data.info !== "OK") {
                    console.error("API è¿”å›é”™è¯¯: ", data);
                    alert("API è¯·æ±‚å¤±è´¥: " + data.info);
                    return;
                }
                
                map.clearMap();
                if (data.pois && data.pois.length > 0) {
                    data.pois.forEach(function(poi) {
                        var marker = new AMap.Marker({
                            position: poi.location.split(","),
                            map: map
                        });

                        var content = `<div class='info'>
                            <strong>${poi.name}</strong><br>
                            åœ°å€: ${poi.address || 'æœªçŸ¥'}<br>
                            ç”µè¯: ${poi.tel || 'æ— '}<br>
                            <span class='copy-btn' onclick='copyToClipboard("${poi.address}")'>ğŸ“‹ å¤åˆ¶åœ°å€</span><br>
                        </div>`;

                        var infoWindow = new AMap.InfoWindow({ content: content });
                        marker.on("click", function() {
                            infoWindow.open(map, marker.getPosition());
                        });
                    });
                } else {
                    alert("æœªæ‰¾åˆ°å……ç”µç«™ä¿¡æ¯ï¼");
                }
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error("è¯·æ±‚å¤±è´¥:", textStatus, errorThrown);
                alert("è¯·æ±‚å¤±è´¥: " + textStatus);
            });
        }

        function getUserLocation() {
            navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                map.setCenter([lng, lat]);
            }, function(error) {
                alert("è·å–ä½ç½®ä¿¡æ¯å¤±è´¥: " + error.message);
            });
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("åœ°å€å·²å¤åˆ¶: " + text);
            }).catch(err => {
                console.error("å¤åˆ¶å¤±è´¥", err);
            });
        }
    </script>
</body>
</html>
