<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>全国小鹏充电站查询</title>
    <script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
    <style>
        #map-container { width: 100%; height: 600px; }
        .control-panel { margin: 10px; padding: 10px; background: #f5f5f5; }
        .info-window img { max-width: 200px; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="control-panel">
        <input type="text" id="city" placeholder="输入城市名称" style="width:200px">
        <button onclick="searchPoi()">搜索</button>
        <button onclick="clearMarkers()">清空</button>
    </div>
    <div id="map-container"></div>

<script>
let map = new AMap.Map('map-container', {
    zoom: 5,
    center: [104.195397, 35.86166]
});
let markers = [];

// 核心搜索功能‌:ml-citation{ref="2,3" data="citationList"}
async function searchPoi() {
    const city = document.getElementById('city').value;
    const url = `https://restapi.amap.com/v3/place/text?key=YOUR_WEB_KEY&keywords=小鹏充电&city=${city}&types=011100&offset=50`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        if(data.pois && data.pois.length > 0) {
            clearMarkers();
            data.pois.forEach(poi => createMarker(poi));
        }
    } catch(error) {
        console.error('API请求失败:', error);
    }
}

// 创建地图标记与信息窗口‌:ml-citation{ref="1,4" data="citationList"}
function createMarker(poi) {
    const marker = new AMap.Marker({
        position: poi.location.split(','),
        map: map
    });

    // 逆地理编码获取详细信息‌:ml-citation{ref="3,4" data="citationList"}
    const infoWindow = new AMap.InfoWindow({
        content: `<div class="info-window">
            <h4>${poi.name}</h4>
            <p>地址：<span class="copyable">${poi.address}</span></p>
            <button onclick="copyAddress('${poi.address}')">复制地址</button>
            <div id="detail-${poi.id}"></div>
        </div>`
    });

    // 绑定点击事件
    marker.on('click', () => {
        getLocationDetails(poi.location, poi.id);
        infoWindow.open(map, marker.getPosition());
    });
    markers.push(marker);
}

// 逆地理编码实现‌:ml-citation{ref="3,4" data="citationList"}
async function getLocationDetails(location, targetId) {
    const url = `https://restapi.amap.com/v3/geocode/regeo?key=YOUR_WEB_KEY&location=${location}`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        const detailDiv = document.getElementById(`detail-${targetId}`);
        
        if(data.regeocode) {
            detailDiv.innerHTML = `
                <p>区域：${data.regeocode.addressComponent.district}</p>
                <p>周边：${data.regeocode.formatted_address}</p>
                <img src="https://restapi.amap.com/v3/staticmap?location=${location}&zoom=15&size=300*150&key=YOUR_WEB_KEY">
            `;
        }
    } catch(error) {
        console.error('逆地理编码失败:', error);
    }
}

// 工具函数
function clearMarkers() {
    markers.forEach(marker => marker.setMap(null));
    markers = [];
}

function copyAddress(text) {
    navigator.clipboard.writeText(text)
        .then(() => alert('地址已复制'))
        .catch(err => console.error('复制失败:', err));
}
</script>
</body>
</html>
