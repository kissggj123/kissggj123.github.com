<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å›½å°é¹å……ç”µç«™</title>
    <!-- ä½¿ç”¨é«˜å¾· JSAPIï¼Œéœ€æ·»åŠ å®‰å…¨å¯†é’¥ -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676&plugin=AMap.PlaceSearch"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #map { width: 100%; height: 600px; }
        .info { font-size: 14px; }
        .copy-btn { cursor: pointer; color: blue; text-decoration: underline; }
        .controls { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>å…¨å›½å°é¹å……ç”µç«™</h2>
    <p>ä½œè€…: @å…”å¯å¯</p>
    <div class="controls">
        <button onclick="fetchPOIData()">åŠ è½½å……ç”µç«™</button>
        <button onclick="getUserLocation()">ğŸ“ è·å–å®šä½</button>
        <button onclick="map.zoomIn()">â• æ”¾å¤§</button>
        <button onclick="map.zoomOut()">â– ç¼©å°</button>
    </div>
    <div id="map"></div>

    <script>
        var map = new AMap.Map("map", {
            center: [116.40, 39.90], // é»˜è®¤åŒ—äº¬ä¸­å¿ƒ
            zoom: 11
        });

        // åŠ è½½å……ç”µç«™æ•°æ®ï¼ˆä½¿ç”¨ JSONP è·¨åŸŸï¼‰
        function fetchPOIData() {
            const key = 'f5be8cdf1391fe2323abc034220d2676';
            const apiUrl = `https://restapi.amap.com/v3/place/text?key=${key}&keywords=å°é¹å……ç”µ&types=011100&offset=20&page=1&extensions=all&output=json`;

            // ä½¿ç”¨ JSONP è¯·æ±‚é¿å…è·¨åŸŸé—®é¢˜
            $.ajax({
                url: apiUrl,
                type: 'GET',
                dataType: 'jsonp',
                jsonp: 'callback',
                success: function(data) {
                    if (data.status === '1') {
                        updateMap(data.pois);
                    } else {
                        alert("API é”™è¯¯: " + data.info);
                    }
                },
                error: function(err) {
                    console.error("è¯·æ±‚å¤±è´¥:", err);
                }
            });
        }

        // æ›´æ–°åœ°å›¾æ ‡è®°
        function updateMap(pois) {
            map.clearMap();
            if (!pois || pois.length === 0) {
                alert("æœªæ‰¾åˆ°å……ç”µç«™ï¼");
                return;
            }

            pois.forEach(poi => {
                const marker = new AMap.Marker({
                    position: poi.location.split(','),
                    map: map
                });

                const infoWindow = new AMap.InfoWindow({
                    content: `<div class="info">
                        <strong>${poi.name}</strong><br>
                        åœ°å€: ${poi.address || 'æœªçŸ¥'}<br>
                        ç”µè¯: ${poi.tel || 'æ— '}<br>
                        <span class="copy-btn" onclick="copyToClipboard('${poi.address}')">ğŸ“‹ å¤åˆ¶åœ°å€</span>
                    </div>`
                });

                marker.on('click', () => infoWindow.open(map, marker.getPosition()));
            });
        }

        // è·å–ç”¨æˆ·å®šä½
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    map.setCenter([pos.coords.longitude, pos.coords.latitude]);
                }, err => {
                    alert("å®šä½å¤±è´¥: " + err.message);
                });
            } else {
                alert("æµè§ˆå™¨ä¸æ”¯æŒå®šä½åŠŸèƒ½");
            }
        }

        // å¤åˆ¶åœ°å€åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("å·²å¤åˆ¶: " + text);
            }).catch(err => {
                console.error("å¤åˆ¶å¤±è´¥", err);
            });
        }
    </script>
</body>
</html>
