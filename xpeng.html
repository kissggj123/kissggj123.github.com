<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>江浙沪小鹏充电站</title>
<script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
#map { width: 100%; height: 500px; }
.info { font-size: 14px; }
.info img { max-width: 100px; margin-top: 5px; }
.copy-btn { margin-top: 5px; cursor: pointer; }
</style>
</head>
<body>
<h2>江浙沪小鹏充电站</h2>
<div id="map"></div>
<script>
var map = new AMap.Map("map", {
    center: [120.373319, 30.258134], // 初始中心点（江浙沪大致中心）
    zoom: 7
});

// 请求高德 API 获取江浙沪的小鹏充电站数据
$.getJSON("https://restapi.amap.com/v3/place/text", {
    key: "f5be8cdf1391fe2323abc034220d2676",
    keywords: "小鹏充电",
    city: "全国", // 设置为全国，但后续通过types和polygon进行区域筛选
    types: "011100|011102|011103|073000|073001|073002",
    output: "json",
    page: 1,
    extensions: "all",
    polygon: "116.0000,30.0000;123.0000,30.0000;123.0000,35.0000;116.0000,35.0000;116.0000,30.0000" // 江浙沪大致范围的多边形
}, function(data) {
    if (data.pois && data.pois.length > 0) {
        data.pois.forEach(function(poi) {
            var marker = new AMap.Marker({
                position: poi.location.split(","),
                map: map
            });

            var content = `<div class='info'>
                <strong>${poi.name}</strong><br>
                地址: ${poi.address || '未知'}<br>
                电话: ${poi.tel || '无'}<br>
                <button class='copy-btn' onclick='copyAddress("${poi.address}")'>复制地址</button>
            `;

            if (poi.photos && poi.photos.length > 0) {
                content += `<img src='${poi.photos.url}' alt='充电站图片'>`;
            }
            content += `</div>`;

            var infoWindow = new AMap.InfoWindow({ content: content });
            marker.on("click", function() {
                infoWindow.open(map, marker.getPosition());
            });
        });
    } else {
        alert("未找到充电站信息！");
    }
});

// 复制地址到剪贴板的函数
function copyAddress(address) {
    var textArea = document.createElement("textarea");
    textArea.value = address;
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
        var successful = document.execCommand('copy');
        var msg = successful ? '成功' : '失败';
        alert('地址复制' + msg);
    } catch (err) {
        alert('地址复制失败');
    }
    document.body.removeChild(textArea);
}
</script>
</body>
</html>
