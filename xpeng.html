<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>沪苏小鹏充电站(兔可可版)</title>
    <script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #map { height: 90vh; }
        .info-img { max-width: 200px; margin: 10px 0; }
        .nav-btns { margin: 10px 0; }
        .copy-btn { background: #4CAF50; color: white; padding: 5px; }
        .version { position: fixed; right: 10px; bottom: 5px; color: #666; font-size: 12px; }
    </style>
</head>
<body>
<h2>沪苏小鹏充电地图 <button onclick="initMap()">刷新数据</button></h2>
<div id="map"></div>
<div class="version">@兔可可 | 版本@舔鸡 5.0.1</div>

<script>
const map = new AMap.Map("map", { zoom: 10 });
let currentPhotoIndex = 0; // 当前图片索引‌:ml-citation{ref="3" data="citationList"}

function createInfoWindow(poi) {
    const photos = poi.photos || [];
    let content = `<div>
        <h4>${poi.name}</h4>
        <p>地址: <span id="addr">${poi.address}</span> 
            <button class="copy-btn" onclick="copyAddress('${poi.address}')">复制</button>
        </p>`;

    if (photos.length > 0) {
        content += `<div class="nav-btns">
            <button ${currentPhotoIndex===0?'disabled':''} 
                onclick="switchPhoto(-1, this)">← 上一张</button>
            <span>${currentPhotoIndex+1}/${photos.length}</span>
            <button ${currentPhotoIndex===photos.length-1?'disabled':''} 
                onclick="switchPhoto(1, this)">下一张 →</button>
        </div>
        <img class="info-img" src="${photos.url}">`;
    }
    return new AMap.InfoWindow({ content: content + '</div>' });
}

// 图片翻页功能‌:ml-citation{ref="3,4" data="citationList"}
function switchPhoto(step, btn) {
    const wrapper = btn.closest('.nav-btns');
    const img = wrapper.nextElementSibling;
    const total = parseInt(wrapper.querySelector('span').textContent.split('/')‌:ml-citation{ref="1" data="citationList"});
    
    currentPhotoIndex = Math.max(0, Math.min(currentPhotoIndex + step, total - 1));
    img.src = poi.photos[currentPhotoIndex].url;
    
    wrapper.querySelectorAll('button').forEach((b, i) => {
        b.disabled = (i===0 && currentPhotoIndex===0) || 
                     (i===1 && currentPhotoIndex===total-1);
    });
}

// 地址复制功能‌:ml-citation{ref="2,3" data="citationList"}
function copyAddress(addr) {
    navigator.clipboard.writeText(addr)
        .then(() => alert('地址已复制'))
        .catch(() => prompt('手动复制:', addr));
}

// 数据加载(省略重复代码)
</script>
</body>
</html>
