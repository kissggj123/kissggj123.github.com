<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>苏州上海杭州小鹏充电站</title>
<script src="https://webapi.amap.com/maps?v=2.0&key=f5be8cdf1391fe2323abc034220d2676"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
#map { width: 100%; height: 500px; }
.info { font-size: 14px; }
.info img { max-width: 100px; margin-top: 5px; }
.copy-btn { margin-top: 5px; cursor: pointer; }
</style>
</head>
<body>
<h2>苏州、上海、杭州小鹏充电站</h2>
<div id="map"></div>
<script>
var map = new AMap.Map("map", {
    center: [120.373319, 30.258134], // 初始中心点设置为江浙沪大致中心
    zoom: 7
});

// 定义苏州、上海、杭州的边界多边形（需根据实际情况调整坐标）
var polygon = new AMap.Polygon({
    path: [
        [120.5, 32], // 苏州北部某点
        [122, 32],   // 上海东部某点
        [122, 30],   // 杭州东部某点
        [119.5, 30], // 杭州西部某点
        [119.5, 32]  // 回到苏州北部，形成闭合多边形
    ],
    strokeColor: "#FF33FF", //线颜色
    strokeOpacity: 0.2,     //线透明度
    strokeWeight: 3,        //线宽
    fillColor: "#1791fc",   //填充色
    fillOpacity: 0.35       //填充透明度
});
map.add(polygon);

// 请求高德API获取充电站数据，使用polygon进行区域搜索
$.getJSON("https://restapi.amap.com/v3/place/in", {
    key: "f5be8cdf1391fe2323abc034220d2676",
    keywords: "小鹏充电",
    types: "011100|011102|011103|073000|073001|073002",
    polygon: polygon.getPath().map(function(point) {
        return point.lng + ',' + point.lat;
    }).join(';'),
    extensions: "all",
    output: "json"
}, function(data) {
    if (data.pois && data.pois.length > 0) {
        data.pois.forEach(function(poi) {
            var marker = new AMap.Marker({
                position: [poi.location.split(","), poi.location.split(",")‌:ml-citation{ref="1" data="citationList"}],
                map: map
            });

            var content = `<div class='info'>
                <strong>${poi.name}</strong><br>
                地址: ${poi.address || '未知'}<br>
                电话: ${poi.tel || '无'}<br>
                <button class='copy-btn' onclick='copyAddress("${poi.address}")'>复制地址</button>
            `;

            if (poi.photos && poi.photos.length > 0) {
                content += `<img src='${poi.photos.url}' alt='充电站图片'>`;
            }
            content += `</div>`;

            var infoWindow = new AMap.InfoWindow({ content: content });
            marker.on("click", function() {
                infoWindow.open(map, marker.getPosition());
            });
        });
    } else {
        alert("未找到充电站信息！");
    }
});

// 复制地址到剪贴板的函数
function copyAddress(address) {
    var textArea = document.createElement("textarea");
    textArea.value = address;
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
        var successful = document.execCommand('copy');
        var msg = successful ? '成功' : '失败';
        alert('地址复制' + msg);
    } catch (err) {
        alert('地址复制失败');
    }
    document.body.removeChild(textArea);
}
</script>
</body>
</html>
